
<!doctype html>
<html lang="ja" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
        <link rel="canonical" href="https://www.manj.io/blog/2022/modern_pgp/">
      
      
        <link rel="prev" href="../../2023/matome/">
      
      
        <link rel="next" href="../sre_event/">
      
      
      <link rel="icon" href="../../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.3">
    
    
      
        <title>今っぽくPGP鍵を作って管理してみる - manj.io</title>
      
    
    
      <link rel="stylesheet" href="../../../assets/stylesheets/main.50c56a3b.min.css">
      
        
        <link rel="stylesheet" href="../../../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
    
    
      <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.6.1/css/font-awesome.min.css">
    
      <link rel="stylesheet" href="../../../assets/css/nav.css">
    
      <link rel="stylesheet" href="../../../assets/css/custom.css">
    
    <script>__md_scope=new URL("../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
<meta property="og:title" content="今っぽくPGP鍵を作って管理してみる - manj.io">
<meta name="twitter:title" content="今っぽくPGP鍵を作って管理してみる - manj.io">


<meta property="og:image" content="https://www.manj.io/assets/img/site.jpg">
<meta name="twitter:image" content="https://www.manj.io/assets/img/site.jpg">


<meta property="og:type" content="article">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@_manji0">
<meta name="twitter:creator" content="@_manji0">
<meta property="og:locale" content="ja_JP">

  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue-gray" data-md-color-accent="red">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#pgp" class="md-skip">
          コンテンツにスキップ
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="ヘッダー">
    <a href="../../.." title="manj.io" class="md-header__button md-logo" aria-label="manj.io" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 2c-1.11 0-2 .89-2 2v16c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V4c0-1.11-.89-2-2-2H4m4.56 4h3.5l3.44 6-3.44 6h-3.5L12 12 8.56 6Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            manj.io
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              今っぽくPGP鍵を作って管理してみる
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue-gray" data-md-color-accent="red"  aria-hidden="true"  type="radio" name="__palette" id="__palette_0">
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="検索" placeholder="検索" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="検索">
        
        <button type="reset" class="md-search__icon md-icon" title="クリア" aria-label="クリア" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            検索を初期化
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="ナビゲーション" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../.." title="manj.io" class="md-nav__button md-logo" aria-label="manj.io" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 2c-1.11 0-2 .89-2 2v16c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V4c0-1.11-.89-2-2-2H4m4.56 4h3.5l3.44 6-3.44 6h-3.5L12 12 8.56 6Z"/></svg>

    </a>
    manj.io
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../.." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Top
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../resume/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Resume
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" checked>
        
          
          <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Blog
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3">
            <span class="md-nav__icon md-icon"></span>
            Blog
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_1" >
        
          
          <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    2023
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_1">
            <span class="md-nav__icon md-icon"></span>
            2023
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2023/matome/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2023 総括
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
    
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
        
        
        
        <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" checked>
        
          
          <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    2022
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="true">
          <label class="md-nav__title" for="__nav_3_2">
            <span class="md-nav__icon md-icon"></span>
            2022
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    今っぽくPGP鍵を作って管理してみる
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    今っぽくPGP鍵を作って管理してみる
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="目次">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目次
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tldr" class="md-nav__link">
    <span class="md-ellipsis">
      TL;DR
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pgp_1" class="md-nav__link">
    <span class="md-ellipsis">
      PGP鍵
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#yubikey" class="md-nav__link">
    <span class="md-ellipsis">
      Yubikey
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#keybase" class="md-nav__link">
    <span class="md-ellipsis">
      Keybase
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pgp_2" class="md-nav__link">
    <span class="md-ellipsis">
      作成するPGP鍵の構造と管理
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gpgkeybase" class="md-nav__link">
    <span class="md-ellipsis">
      GPGでの鍵作成とKeybaseへの公開鍵登録
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GPGでの鍵作成とKeybaseへの公開鍵登録">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gpg" class="md-nav__link">
    <span class="md-ellipsis">
      GPG
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      鍵の生成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      副鍵の追加
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setprof" class="md-nav__link">
    <span class="md-ellipsis">
      setprofする
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#yubikey_1" class="md-nav__link">
    <span class="md-ellipsis">
      Yubikeyへの転送
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Yubikeyへの転送">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#yubikey-pgp" class="md-nav__link">
    <span class="md-ellipsis">
      Yubikey PGP機能のリセット
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      主鍵、副鍵のバックアップ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#yubikeypgp" class="md-nav__link">
    <span class="md-ellipsis">
      YubikeyへのPGP鍵書き込み
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      用途別の鍵の作成と署名
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      公開
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcyubikey" class="md-nav__link">
    <span class="md-ellipsis">
      別のPCでYubikeyを使う
    </span>
  </a>
  
    <nav class="md-nav" aria-label="別のPCでYubikeyを使う">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      組織別の鍵を登録、署名、公開
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#github" class="md-nav__link">
    <span class="md-ellipsis">
      Githubへ登録
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#git" class="md-nav__link">
    <span class="md-ellipsis">
      Gitの設定
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#github_1" class="md-nav__link">
    <span class="md-ellipsis">
      Github上での見え方
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../sre_event/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    6社合同SRE勉強会
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../atcoder_green/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    AtCoderで入緑した
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../apex/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    APEXと現実世界での仕事の繋がり、新卒採用について
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../happynewyear/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    2022 年始
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
              
                
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_3_3" >
        
          
          <label class="md-nav__link" for="__nav_3_3" id="__nav_3_3_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    2021
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_3_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_3_3">
            <span class="md-nav__icon md-icon"></span>
            2021
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2021/mkdocs-as-blog/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    mkdocsでブログを作ってみる
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2021/pro-ogo/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    プロ奢に5万円渡して3時間半通話した件について
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2021/favorite-songs-2021-1st/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    好きな曲 2021年度上期
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2021/designing-an-interview-for-engineering-team/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    エンジニア組織で面接を設計するときに考えたこと
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2021/the-dangers-of-depending-on-gmail/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    The dangers of depending on Gmail
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2021/what-are-the-sre-activities-for-complex-and-large-services/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    What are the SRE activities for complex and large services?
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2021/wais-4/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    心理検査の結果と所感
  </span>
  

      </a>
    </li>
  

              
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../2021/what-i-think-about-when-i-work-as-an-sre/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    SREとして仕事をするときに考えてること
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
      
      
  
  
  
  
    
    
    
    
    
    <li class="md-nav__item md-nav__item--nested">
      
        
        
        
          
        
        <input class="md-nav__toggle md-toggle md-toggle--indeterminate" type="checkbox" id="__nav_4" >
        
          
          <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
            
  
  <span class="md-ellipsis">
    Coding
  </span>
  

            <span class="md-nav__icon md-icon"></span>
          </label>
        
        <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
          <label class="md-nav__title" for="__nav_4">
            <span class="md-nav__icon md-icon"></span>
            Coding
          </label>
          <ul class="md-nav__list" data-md-scrollfix>
            
              
                
  
  
  
  
    <li class="md-nav__item">
      <a href="../../../coding/abc188-c/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    ABC188 C - ABC Tournament
  </span>
  

      </a>
    </li>
  

              
            
          </ul>
        </nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="目次">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      目次
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#tldr" class="md-nav__link">
    <span class="md-ellipsis">
      TL;DR
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pgp_1" class="md-nav__link">
    <span class="md-ellipsis">
      PGP鍵
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#yubikey" class="md-nav__link">
    <span class="md-ellipsis">
      Yubikey
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#keybase" class="md-nav__link">
    <span class="md-ellipsis">
      Keybase
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pgp_2" class="md-nav__link">
    <span class="md-ellipsis">
      作成するPGP鍵の構造と管理
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#gpgkeybase" class="md-nav__link">
    <span class="md-ellipsis">
      GPGでの鍵作成とKeybaseへの公開鍵登録
    </span>
  </a>
  
    <nav class="md-nav" aria-label="GPGでの鍵作成とKeybaseへの公開鍵登録">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#gpg" class="md-nav__link">
    <span class="md-ellipsis">
      GPG
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_1" class="md-nav__link">
    <span class="md-ellipsis">
      鍵の生成
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    <span class="md-ellipsis">
      副鍵の追加
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#setprof" class="md-nav__link">
    <span class="md-ellipsis">
      setprofする
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#yubikey_1" class="md-nav__link">
    <span class="md-ellipsis">
      Yubikeyへの転送
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Yubikeyへの転送">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#yubikey-pgp" class="md-nav__link">
    <span class="md-ellipsis">
      Yubikey PGP機能のリセット
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    <span class="md-ellipsis">
      主鍵、副鍵のバックアップ
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#yubikeypgp" class="md-nav__link">
    <span class="md-ellipsis">
      YubikeyへのPGP鍵書き込み
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    <span class="md-ellipsis">
      用途別の鍵の作成と署名
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    <span class="md-ellipsis">
      公開
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#pcyubikey" class="md-nav__link">
    <span class="md-ellipsis">
      別のPCでYubikeyを使う
    </span>
  </a>
  
    <nav class="md-nav" aria-label="別のPCでYubikeyを使う">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    <span class="md-ellipsis">
      組織別の鍵を登録、署名、公開
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#github" class="md-nav__link">
    <span class="md-ellipsis">
      Githubへ登録
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#git" class="md-nav__link">
    <span class="md-ellipsis">
      Gitの設定
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#github_1" class="md-nav__link">
    <span class="md-ellipsis">
      Github上での見え方
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="pgp">今っぽくPGP鍵を作って管理してみる<a class="headerlink" href="#pgp" title="Permanent link">&para;</a></h1>
<h2 id="tldr">TL;DR<a class="headerlink" href="#tldr" title="Permanent link">&para;</a></h2>
<ul>
<li>Yubikeyにmaster keyを格納</li>
<li>普段使いする鍵はmaster keyで署名した別鍵</li>
<li>主鍵はP521で作る</li>
<li>副鍵は用途に合わせてアルゴリズムを選ぶ<ul>
<li>Sign: P521</li>
<li>Encrypt: RSA4096</li>
<li>Auth: ed25519</li>
</ul>
</li>
</ul>
<h2 id="pgp_1">PGP鍵<a class="headerlink" href="#pgp_1" title="Permanent link">&para;</a></h2>
<p>大昔からあるPGP。今でも個人間での暗号文のやりとりや、Git commitの署名などに使われている。スノーデン騒動のときにちょっと話題になったりした記憶がある。</p>
<p>現代では公開鍵の広報に昔ながらのkeyserverだけでなく<a href="https://keybase.io/">keybase</a>がそこそこ使われるようになっており、SNS的な文化との融合が進んでいる。</p>
<p>また、概念が分散モデルであり昨今のWeb3うんたらの流行にマッチしていることから、個人的にはこれからインターネット上の個人証明手段としての存在感が増していくのではないかと考えている。</p>
<p>最近僕は副業を探し始めたり、仕事の一環でOSSにコミットしたりすることがあったりで、Github上で「どの立場で書いたコードなのか」を明らかにしたいというモチベーションがあった。なので、そのために所属組織ごとにPGP鍵を管理することとした。</p>
<h2 id="yubikey">Yubikey<a class="headerlink" href="#yubikey" title="Permanent link">&para;</a></h2>
<p>YubikeyはOTP, FIDO U2F, FIDO2, OpenPGPなどに対応した物理キーである。今時セキュリティに敏感な人なら誰でも知ってるブランドではないだろうか。</p>
<p>昔USB-C&amp;NFCに対応したモデルが出たときに買っていたのだが、全く使っていなかった。</p>
<p>今回PGP鍵を管理するにあたって、「どこかのマシンに鍵データを置く」ことを避けたかったので、外部から読み出し不可能な鍵ストレージとしてYubikeyを使い始めることにした。</p>
<h2 id="keybase">Keybase<a class="headerlink" href="#keybase" title="Permanent link">&para;</a></h2>
<p><a href="https://keybase.io/">Keybase</a>はPGP鍵および各種アカウントと個人の紐付けを承認する &amp; keybaseアカウント間でのPGPによる暗号文通信を提供するサービス。</p>
<p>SNSのようなフォロー、フォロワーの概念が存在し、フォローしてる人のPGP公開鍵をマシンにインポートしたりすることができる。</p>
<p>なんとなく今時はここにPGP公開鍵を広報するのがモダンな感じがするので、ここに公開できる鍵形式でmaster keyを作ることを目標にしたい。</p>
<h2 id="pgp_2">作成するPGP鍵の構造と管理<a class="headerlink" href="#pgp_2" title="Permanent link">&para;</a></h2>
<p>今回は</p>
<ul>
<li>master keyとして1つの鍵束を作成 → Yubikeyに保存</li>
<li>個人用の鍵として1つの鍵束を作成 → master keyで署名して個人マシンに保存</li>
<li>所属組織ごとに鍵束を作成 → master keyで署名して各組織用のマシンに保存</li>
</ul>
<p>することを目指す。master keyは他の鍵に署名できる必要があるので、master keyのmain keyもyubikeyに保存する。</p>
<p>これらの鍵はすべてkeybaseに登録されることとする。</p>
<p>PGP用語である主鍵、副鍵などの概念については面倒なので説明しない。</p>
<p>詳しいことは<a href="https://help.gnome.org/users/seahorse/stable/index.html.en#pgp-keys">gnomeのhelpページ</a>とか読めば分かる。</p>
<h2 id="gpgkeybase">GPGでの鍵作成とKeybaseへの公開鍵登録<a class="headerlink" href="#gpgkeybase" title="Permanent link">&para;</a></h2>
<h3 id="gpg">GPG<a class="headerlink" href="#gpg" title="Permanent link">&para;</a></h3>
<p>GNUのpgp実装。Mac OSだとデフォルトではコマンドが叩けない。</p>
<p>今回はhomebrewで<code>2.3.7</code>を入れてそれを使う。</p>
<h3 id="_1">鍵の生成<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h3>
<p>主鍵はNIST P521を使う。Yubikey 5が対応している &amp; 楕円曲線が好きだという理由。</p>
<p>RSA4096でも実用上問題は無いはずだが、公開鍵のサイズが大きくなるので注意。一般に楕円曲線暗号鍵の方がRSA暗号鍵より強度あたりの公開鍵のサイズが小さいと認識している。</p>
<p>BrainpoolはYubikeyが対応していないと思う(ソースが曖昧)ので選ばないよう気をつける。</p>
<div class="highlight"><pre><span></span><code>gpg --full-gen-key --expert
gpg (GnuPG) 2.3.7; Copyright (C) 2021 Free Software Foundation, Inc.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

ご希望の鍵の種類を選択してください:
   (1) RSA と RSA
   (2) DSA と Elgamal
   (3) DSA (署名のみ)
   (4) RSA (署名のみ)
   (7) DSA (機能をあなた自身で設定)
   (8) RSA (機能をあなた自身で設定)
   (9) ECC (署名と暗号化) *デフォルト
  (10) ECC (署名のみ)
  (11) ECC (機能をあなた自身で設定)
  (13) 既存の鍵
  (14) カードに存在する鍵
あなたの選択は? 9
ご希望の楕円曲線を選択してください:
   (1) Curve 25519 *デフォルト
   (2) Curve 448
   (3) NIST P-256
   (4) NIST P-384
   (5) NIST P-521
   (6) Brainpool P-256
   (7) Brainpool P-384
   (8) Brainpool P-512
   (9) secp256k1
あなたの選択は? 5
鍵の有効期限を指定してください。
         0 = 鍵は無期限
      &lt;n&gt;  = 鍵は n 日間で期限切れ
      &lt;n&gt;w = 鍵は n 週間で期限切れ
      &lt;n&gt;m = 鍵は n か月間で期限切れ
      &lt;n&gt;y = 鍵は n 年間で期限切れ
鍵の有効期間は? (0)0
鍵は無期限です
これで正しいですか? (y/N) y

GnuPGはあなたの鍵を識別するためにユーザIDを構成する必要があります。

本名: John Wick
電子メール・アドレス: john@example.com
コメント: example
次のユーザIDを選択しました:
    &quot;John Wick (example) &lt;john@example.com&gt;&quot;

名前(N)、コメント(C)、電子メール(E)の変更、またはOK(O)か終了(Q)? O
たくさんのランダム・バイトの生成が必要です。キーボードを打つ、マウスを動か
す、ディスクにアクセスするなどの他の操作を素数生成の間に行うことで、乱数生
成器に十分なエントロピーを供給する機会を与えることができます。
たくさんのランダム・バイトの生成が必要です。キーボードを打つ、マウスを動か
す、ディスクにアクセスするなどの他の操作を素数生成の間に行うことで、乱数生
成器に十分なエントロピーを供給する機会を与えることができます。
gpg: 失効証明書を &#39;/Users/manji0/.gnupg/openpgp-revocs.d/40D8FB9F15D6A5E7491B3CC796E9266F721E54E4.rev&#39; に保管しました。
公開鍵と秘密鍵を作成し、署名しました。

pub   nistp521 2022-08-20 [SC]
      40D8FB9F15D6A5E7491B3CC796E9266F721E54E4
uid                      John Wick (example) &lt;john@example.com&gt;
sub   nistp521 2022-08-20 [E]
</code></pre></div>
<p>作成後の確認</p>
<div class="highlight"><pre><span></span><code>$ gpg -K

sec   nistp521 2022-08-20 [SC]
      40D8FB9F15D6A5E7491B3CC796E9266F721E54E4
uid           [  究極  ] John Wick (example) &lt;john@example.com&gt;
ssb   nistp521 2022-08-20 [E]
</code></pre></div>
<h3 id="_2">副鍵の追加<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h3>
<p>P521は復号速度が遅いので、Encrypt鍵はRSAで再作成する。SignはP521でよい。Authはopensshとの互換性を踏まえてed25519を使う。</p>
<p>手順は以下。</p>
<ol>
<li>Encrypt用の副鍵を削除</li>
<li>Encrypt用の副鍵を作成(RSA4096)</li>
<li>Sign用の副鍵を作成(NIST P521)</li>
<li>Auth用の副鍵を作成(ed25519)</li>
</ol>
<div class="highlight"><pre><span></span><code>gpg --expert --edit-key 40D8FB9F15D6A5E7491B3CC796E9266F721E54E4
gpg (GnuPG) 2.3.7; Copyright (C) 2021 Free Software Foundation, Inc.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

秘密鍵が利用できます。

sec  nistp521/96E9266F721E54E4
     作成: 2022-08-20  有効期限: 無期限      利用法: SC
     信用: 究極        有効性: 究極
ssb  nistp521/6FE32982D3CFE6AE
     作成: 2022-08-20  有効期限: 無期限      利用法: E
[  究極  ] (1). John Wick (example) &lt;john@example.com&gt;

gpg&gt; ## Delete exist key
gpg&gt; key 1

sec  nistp521/96E9266F721E54E4
     作成: 2022-08-20  有効期限: 無期限      利用法: SC
     信用: 究極        有効性: 究極
ssb* nistp521/6FE32982D3CFE6AE
     作成: 2022-08-20  有効期限: 無期限      利用法: E
[  究極  ] (1). John Wick (example) &lt;john@example.com&gt;

gpg&gt; delkey
この鍵を本当に削除しますか? (y/N) y

sec  nistp521/96E9266F721E54E4
     作成: 2022-08-20  有効期限: 無期限      利用法: SC
     信用: 究極        有効性: 究極
[  究極  ] (1). John Wick (example) &lt;john@example.com&gt;

gpg&gt; ## Add subkey for Encrypt
gpg&gt; addkey
ご希望の鍵の種類を選択してください:
   (3) DSA (署名のみ)
   (4) RSA (署名のみ)
   (5) Elgamal (暗号化のみ)
   (6) RSA (暗号化のみ)
   (7) DSA (機能をあなた自身で設定)
   (8) RSA (機能をあなた自身で設定)
  (10) ECC (署名のみ)
  (11) ECC (機能をあなた自身で設定)
  (12) ECC (暗号化のみ)
  (13) 既存の鍵
  (14) カードに存在する鍵
あなたの選択は? 6
RSA 鍵は 1024 から 4096 ビットの長さで可能です。
鍵長は? (3072) 4096
要求された鍵長は4096ビット
鍵の有効期限を指定してください。
         0 = 鍵は無期限
      &lt;n&gt;  = 鍵は n 日間で期限切れ
      &lt;n&gt;w = 鍵は n 週間で期限切れ
      &lt;n&gt;m = 鍵は n か月間で期限切れ
      &lt;n&gt;y = 鍵は n 年間で期限切れ
鍵の有効期間は? (0)
鍵は無期限です
これで正しいですか? (y/N) y
本当に作成しますか? (y/N) y
たくさんのランダム・バイトの生成が必要です。キーボードを打つ、マウスを動か
す、ディスクにアクセスするなどの他の操作を素数生成の間に行うことで、乱数生
成器に十分なエントロピーを供給する機会を与えることができます。

sec  nistp521/96E9266F721E54E4
     作成: 2022-08-20  有効期限: 無期限      利用法: SC
     信用: 究極        有効性: 究極
ssb  rsa4096/36F15D8D3A16899C
     作成: 2022-08-20  有効期限: 無期限      利用法: E
[  究極  ] (1). John Wick (example) &lt;john@example.com&gt;

gpg&gt; ## Add subkey for Sign
gpg&gt; addkey
ご希望の鍵の種類を選択してください:
   (3) DSA (署名のみ)
   (4) RSA (署名のみ)
   (5) Elgamal (暗号化のみ)
   (6) RSA (暗号化のみ)
   (7) DSA (機能をあなた自身で設定)
   (8) RSA (機能をあなた自身で設定)
  (10) ECC (署名のみ)
  (11) ECC (機能をあなた自身で設定)
  (12) ECC (暗号化のみ)
  (13) 既存の鍵
  (14) カードに存在する鍵
あなたの選択は? 10
ご希望の楕円曲線を選択してください:
   (1) Curve 25519 *デフォルト
   (2) Curve 448
   (3) NIST P-256
   (4) NIST P-384
   (5) NIST P-521
   (6) Brainpool P-256
   (7) Brainpool P-384
   (8) Brainpool P-512
   (9) secp256k1
あなたの選択は? 5
鍵の有効期限を指定してください。
         0 = 鍵は無期限
      &lt;n&gt;  = 鍵は n 日間で期限切れ
      &lt;n&gt;w = 鍵は n 週間で期限切れ
      &lt;n&gt;m = 鍵は n か月間で期限切れ
      &lt;n&gt;y = 鍵は n 年間で期限切れ
鍵の有効期間は? (0)0
鍵は無期限です
これで正しいですか? (y/N) y
本当に作成しますか? (y/N) y
たくさんのランダム・バイトの生成が必要です。キーボードを打つ、マウスを動か
す、ディスクにアクセスするなどの他の操作を素数生成の間に行うことで、乱数生
成器に十分なエントロピーを供給する機会を与えることができます。

sec  nistp521/96E9266F721E54E4
     作成: 2022-08-20  有効期限: 無期限      利用法: SC
     信用: 究極        有効性: 究極
ssb  rsa4096/36F15D8D3A16899C
     作成: 2022-08-20  有効期限: 無期限      利用法: E
ssb  nistp521/78D108ED2D99529D
     作成: 2022-08-20  有効期限: 無期限      利用法: S
[  究極  ] (1). John Wick (example) &lt;john@example.com&gt;

gpg&gt; ## Add subkey for Auth
gpg&gt; addkey
ご希望の鍵の種類を選択してください:
   (3) DSA (署名のみ)
   (4) RSA (署名のみ)
   (5) Elgamal (暗号化のみ)
   (6) RSA (暗号化のみ)
   (7) DSA (機能をあなた自身で設定)
   (8) RSA (機能をあなた自身で設定)
  (10) ECC (署名のみ)
  (11) ECC (機能をあなた自身で設定)
  (12) ECC (暗号化のみ)
  (13) 既存の鍵
  (14) カードに存在する鍵
あなたの選択は? 11

このECC鍵にありうる操作: Sign Authenticate
現在の認められた操作: Sign

   (S) 署名機能を反転する
   (A) 認証機能を反転する
   (Q) 完了

あなたの選択は? S

このECC鍵にありうる操作: Sign Authenticate
現在の認められた操作:

   (S) 署名機能を反転する
   (A) 認証機能を反転する
   (Q) 完了

あなたの選択は? A

このECC鍵にありうる操作: Sign Authenticate
現在の認められた操作: Authenticate

   (S) 署名機能を反転する
   (A) 認証機能を反転する
   (Q) 完了

あなたの選択は? Q
ご希望の楕円曲線を選択してください:
   (1) Curve 25519 *デフォルト
   (2) Curve 448
   (3) NIST P-256
   (4) NIST P-384
   (5) NIST P-521
   (6) Brainpool P-256
   (7) Brainpool P-384
   (8) Brainpool P-512
   (9) secp256k1
あなたの選択は? 1
鍵の有効期限を指定してください。
         0 = 鍵は無期限
      &lt;n&gt;  = 鍵は n 日間で期限切れ
      &lt;n&gt;w = 鍵は n 週間で期限切れ
      &lt;n&gt;m = 鍵は n か月間で期限切れ
      &lt;n&gt;y = 鍵は n 年間で期限切れ
鍵の有効期間は? (0)
鍵は無期限です
これで正しいですか? (y/N) y
本当に作成しますか? (y/N) y
たくさんのランダム・バイトの生成が必要です。キーボードを打つ、マウスを動か
す、ディスクにアクセスするなどの他の操作を素数生成の間に行うことで、乱数生
成器に十分なエントロピーを供給する機会を与えることができます。

sec  nistp521/96E9266F721E54E4
     作成: 2022-08-20  有効期限: 無期限      利用法: SC
     信用: 究極        有効性: 究極
ssb  rsa4096/36F15D8D3A16899C
     作成: 2022-08-20  有効期限: 無期限      利用法: E
ssb  nistp521/78D108ED2D99529D
     作成: 2022-08-20  有効期限: 無期限      利用法: S
ssb  ed25519/B171BE1DDD21233D
     作成: 2022-08-20  有効期限: 無期限      利用法: A
[  究極  ] (1). John Wick (example) &lt;john@example.com&gt;

gpg&gt; save
</code></pre></div>
<h3 id="setprof">setprofする<a class="headerlink" href="#setprof" title="Permanent link">&para;</a></h3>
<p>この手順で作成したPGP鍵について、公開鍵をKeybaseに登録しようとするとエラーが出て失敗する。</p>
<p>この問題については<a href="https://github.com/keybase/keybase-issues/issues/4025">GithubでIssueが立っており</a>、<code>setpref</code>で公開鍵の属性を編集することで回避することができると判明している。</p>
<p><code>setpref AES256 AES192 AES 3DES SHA512 SHA384 SHA256 SHA224 SHA1 ZLIB BZIP2 ZIP mdc no-ks-modify</code></p>
<div class="highlight"><pre><span></span><code>$ gpg --edit-key 40D8FB9F15D6A5E7491B3CC796E9266F721E54E4
gpg (GnuPG) 2.3.7; Copyright (C) 2021 Free Software Foundation, Inc.
This is free software: you are free to change and redistribute it.
There is NO WARRANTY, to the extent permitted by law.

秘密鍵が利用できます。

sec  nistp521/96E9266F721E54E4
     作成: 2022-08-20  有効期限: 無期限      利用法: SC
     信用: 究極        有効性: 究極
ssb  rsa4096/36F15D8D3A16899C
     作成: 2022-08-20  有効期限: 無期限      利用法: E
ssb  nistp521/78D108ED2D99529D
     作成: 2022-08-20  有効期限: 無期限      利用法: S
ssb  ed25519/B171BE1DDD21233D
     作成: 2022-08-20  有効期限: 無期限      利用法: A
[  究極  ] (1). John Wick (example) &lt;john@example.com&gt;

gpg&gt; setpref AES256 AES192 AES 3DES SHA512 SHA384 SHA256 SHA224 SHA1 ZLIB BZIP2 ZIP mdc no-ks-modify
優先指定の一覧を設定:
     暗号方式: AES256, AES192, AES, 3DES
     AEAD:
     ダイジェスト: SHA512, SHA384, SHA256, SHA224, SHA1
     圧縮: ZLIB, BZIP2, ZIP, 無圧縮
     機能: MDC, 鍵サーバ 修正しない
優先指定を本当に更新しますか? (y/N) y

sec  nistp521/96E9266F721E54E4
     作成: 2022-08-20  有効期限: 無期限      利用法: SC
     信用: 究極        有効性: 究極
ssb  rsa4096/36F15D8D3A16899C
     作成: 2022-08-20  有効期限: 無期限      利用法: E
ssb  nistp521/78D108ED2D99529D
     作成: 2022-08-20  有効期限: 無期限      利用法: S
ssb  ed25519/B171BE1DDD21233D
     作成: 2022-08-20  有効期限: 無期限      利用法: A
[  究極  ] (1). John Wick (example) &lt;john@example.com&gt;

gpg&gt; save
</code></pre></div>
<p>この処理を施した後、<code>$ keybase pgp select --multi</code> を使ってアップロードすることができるようになる。</p>
<h2 id="yubikey_1">Yubikeyへの転送<a class="headerlink" href="#yubikey_1" title="Permanent link">&para;</a></h2>
<h3 id="yubikey-pgp">Yubikey PGP機能のリセット<a class="headerlink" href="#yubikey-pgp" title="Permanent link">&para;</a></h3>
<p>YubikeyをMacに挿した状態で、<code>gpg --card-edit</code>からリセットする。</p>
<div class="highlight"><pre><span></span><code>$ gpg --card-edit

# ここにYubikeyの情報がずらずら出てくる

gpg/card&gt; admin
管理者コマンドが許可されています

gpg/card&gt; help
quit           このメニューを終了
admin          管理コマンドを表示
help           このヘルプを表示
list           全有効データを表示
name           カード所有者の名前の変更
url            鍵を取得するURLの変更
fetch          カードURLで指定された鍵の取得
login          ログイン名の変更
lang           言語の優先指定の変更
salutation     カード所有者の敬称の変更
cafpr          CAフィンガープリントの変更
forcesig       署名強制PINフラグを反転
generate       新しい鍵を生成
passwd         PINブロックの解除や変更のメニュー
verify         PINを確認しすべてのデータを表示する
unblock        PINをリセット・コードでブロックを解除する
factory-reset  すべての鍵とデータを破壊します
kdf-setup      PIN認証のKDFを設定する (on/single/off)
key-attr       鍵の属性の変更
uif            ユーザインタラクションフラグの変更
</code></pre></div>
<p><code>factory-reset</code> した後、<code>passwd</code> を使ってPINを設定する。</p>
<p>factory reset後のPINはデフォルト値に設定される。</p>
<ul>
<li>PIN: <code>123456</code></li>
<li>Admin PIN: <code>12345678</code></li>
</ul>
<h3 id="_3">主鍵、副鍵のバックアップ<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<ul>
<li><code>gpg --armor --export-secret-keys &lt;ID&gt;</code></li>
<li><code>gpg --armor --export-secret-subkeys &lt;ID&gt;</code></li>
</ul>
<p>で書き出し、どこか安全な場所に置く。</p>
<p>QRコードにして印刷して金庫にでも入れておくのが一番よい。</p>
<h3 id="yubikeypgp">YubikeyへのPGP鍵書き込み<a class="headerlink" href="#yubikeypgp" title="Permanent link">&para;</a></h3>
<p>作ったkeyをedit modeから<code>keytocard</code>する。</p>
<p>手順は<a href="https://keens.github.io/blog/2021/03/23/yubikeywotsukau_openpghen/">ここ</a>が参考になる。</p>
<p>keytocardした後、<code>gpg&gt; save</code> しないと鍵がローカルに残ったままになるので注意。</p>
<h2 id="_4">用途別の鍵の作成と署名<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h2>
<p>個人用に <code>$ gpg --full-gen-key --expert</code> で鍵を作成する。</p>
<p>また、MacでYubikey内の鍵を使えるように<a href="https://github.com/drduh/YubiKey-Guide#macos">公式ガイド</a>を参考に必要な設定を済ませておく。</p>
<p>その後、<code>$ gpg -u &lt;master key id&gt; --sign-key &lt;key id&gt;</code> でuidを署名していく。</p>
<h2 id="_5">公開<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h2>
<p><code>$ gpg --export &lt;key id&gt; | curl -T - https://keys.openpgp.org</code> などで公開する。</p>
<p>keys.openpgp.orgを使う場合、コマンド実行後にメールの認証リンクが表示されるのでそれを使ってメールアドレスの認証を実施する必要がある。</p>
<p>keybaseにも公開する場合には、setprofした後に <code>$ keybase pgp select --multi</code> でアップロードしていく。</p>
<h2 id="pcyubikey">別のPCでYubikeyを使う<a class="headerlink" href="#pcyubikey" title="Permanent link">&para;</a></h2>
<p><a href="https://github.com/drduh/YubiKey-Guide#macos">公式ガイド</a>に従って環境を整えた後、</p>
<ul>
<li><code>$ gpg --card-edit</code></li>
<li><code>gpg&gt; verify</code></li>
</ul>
<p>で認証し、gpgの秘密鍵リストを更新する。 <code>$ gpg -K</code> で鍵が見えれば成功。</p>
<p>Signなどの操作を実行する場合、エラーが出る場合がある。恐らく<code>export GPG_TTY=$(tty)</code> をすると解決する。</p>
<h3 id="_6">組織別の鍵を登録、署名、公開<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<p>それぞれのPCで署名操作の実施可能を確認した後、個人用と同じように組織別の鍵を作成し、Yubikeyの鍵を使って署名、公開する。</p>
<h2 id="github">Githubへ登録<a class="headerlink" href="#github" title="Permanent link">&para;</a></h2>
<p>Githubにログインし、Preference → SSH and GPG keysから登録する。</p>
<h2 id="git">Gitの設定<a class="headerlink" href="#git" title="Permanent link">&para;</a></h2>
<p>コミット時に自動で署名するよう、gitconfigを設定する。</p>
<div class="highlight"><pre><span></span><code>[user]
    name = Wataru Manji
    email = &lt;each mail address&gt;
    signingkey = &lt;key id&gt;
[commit]
    gpgsign = true
</code></pre></div>
<h2 id="github_1">Github上での見え方<a class="headerlink" href="#github_1" title="Permanent link">&para;</a></h2>
<p><a href="https://github.com/manji-0/blog/commit/e22f74fe03ee79f1d3839537c545e522930100d3">こんな感じ</a></p>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
          <button type="button" class="md-top md-icon" data-md-component="top" hidden>
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12Z"/></svg>
  ページトップへ戻る
</button>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      &copy; 2021 - 2021 Wataru Manji
    </div>
  
  
</div>
      
        <div class="md-social">
  
    
    
    
    
    <a href="https://twitter.com/_manji0" target="_blank" rel="noopener" title="manji0 on Twitter" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg>
    </a>
  
    
    
      
    
    
    
      
      
    
    <a href="https://misskey.io/@manji0" target="_blank" rel="noopener me" title="misskey.io" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M433 179.11c0-97.2-63.71-125.7-63.71-125.7-62.52-28.7-228.56-28.4-290.48 0 0 0-63.72 28.5-63.72 125.7 0 115.7-6.6 259.4 105.63 289.1 40.51 10.7 75.32 13 103.33 11.4 50.81-2.8 79.32-18.1 79.32-18.1l-1.7-36.9s-36.31 11.4-77.12 10.1c-40.41-1.4-83-4.4-89.63-54a102.54 102.54 0 0 1-.9-13.9c85.63 20.9 158.65 9.1 178.75 6.7 56.12-6.7 105-41.3 111.23-72.9 9.8-49.8 9-121.5 9-121.5zm-75.12 125.2h-46.63v-114.2c0-49.7-64-51.6-64 6.9v62.5h-46.33V197c0-58.5-64-56.6-64-6.9v114.2H90.19c0-122.1-5.2-147.9 18.41-175 25.9-28.9 79.82-30.8 103.83 6.1l11.6 19.5 11.6-19.5c24.11-37.1 78.12-34.8 103.83-6.1 23.71 27.3 18.4 53 18.4 175z"/></svg>
    </a>
  
    
    
    
    
    <a href="https://discordapp.com/users/335975911478394881" target="_blank" rel="noopener" title="manji0 on Discord" class="md-social__link">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><!--! Font Awesome Free 6.5.1 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M524.531 69.836a1.5 1.5 0 0 0-.764-.7A485.065 485.065 0 0 0 404.081 32.03a1.816 1.816 0 0 0-1.923.91 337.461 337.461 0 0 0-14.9 30.6 447.848 447.848 0 0 0-134.426 0 309.541 309.541 0 0 0-15.135-30.6 1.89 1.89 0 0 0-1.924-.91 483.689 483.689 0 0 0-119.688 37.107 1.712 1.712 0 0 0-.788.676C39.068 183.651 18.186 294.69 28.43 404.354a2.016 2.016 0 0 0 .765 1.375 487.666 487.666 0 0 0 146.825 74.189 1.9 1.9 0 0 0 2.063-.676A348.2 348.2 0 0 0 208.12 430.4a1.86 1.86 0 0 0-1.019-2.588 321.173 321.173 0 0 1-45.868-21.853 1.885 1.885 0 0 1-.185-3.126 251.047 251.047 0 0 0 9.109-7.137 1.819 1.819 0 0 1 1.9-.256c96.229 43.917 200.41 43.917 295.5 0a1.812 1.812 0 0 1 1.924.233 234.533 234.533 0 0 0 9.132 7.16 1.884 1.884 0 0 1-.162 3.126 301.407 301.407 0 0 1-45.89 21.83 1.875 1.875 0 0 0-1 2.611 391.055 391.055 0 0 0 30.014 48.815 1.864 1.864 0 0 0 2.063.7A486.048 486.048 0 0 0 610.7 405.729a1.882 1.882 0 0 0 .765-1.352c12.264-126.783-20.532-236.912-86.934-334.541ZM222.491 337.58c-28.972 0-52.844-26.587-52.844-59.239s23.409-59.241 52.844-59.241c29.665 0 53.306 26.82 52.843 59.239 0 32.654-23.41 59.241-52.843 59.241Zm195.38 0c-28.971 0-52.843-26.587-52.843-59.239s23.409-59.241 52.843-59.241c29.667 0 53.307 26.82 52.844 59.239 0 32.654-23.177 59.241-52.844 59.241Z"/></svg>
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "../../..", "features": ["header.autohide", "navigation.expand", "navigation.top", "search.highlight"], "search": "../../../assets/javascripts/workers/search.f886a092.min.js", "translations": {"clipboard.copied": "\u30b3\u30d4\u30fc\u3057\u307e\u3057\u305f", "clipboard.copy": "\u30af\u30ea\u30c3\u30d7\u30dc\u30fc\u30c9\u3078\u30b3\u30d4\u30fc", "search.result.more.one": "\u3053\u306e\u30da\u30fc\u30b8\u5185\u306b\u3082\u30461\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.more.other": "\u3053\u306e\u30da\u30fc\u30b8\u5185\u306b\u3042\u3068#\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.none": "\u4f55\u3082\u898b\u3064\u304b\u308a\u307e\u305b\u3093\u3067\u3057\u305f", "search.result.one": "1\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.other": "#\u4ef6\u898b\u3064\u304b\u308a\u307e\u3057\u305f", "search.result.placeholder": "\u691c\u7d22\u30ad\u30fc\u30ef\u30fc\u30c9\u3092\u5165\u529b\u3057\u3066\u304f\u3060\u3055\u3044", "search.result.term.missing": "\u691c\u7d22\u306b\u542b\u307e\u308c\u306a\u3044", "select.version": "\u30d0\u30fc\u30b8\u30e7\u30f3\u5207\u308a\u66ff\u3048"}}</script>
    
    
      <script src="../../../assets/javascripts/bundle.d7c377c4.min.js"></script>
      
        <script src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/tablesort/5.2.1/tablesort.min.js"></script>
      
        <script src="../../../assets/js/tablesort.js"></script>
      
    
  </body>
</html>